<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Lukas Woodtli">
    <meta name="author" content="Lukas Woodtli">

        <title>Mastering Embedded Linux&nbsp;Programming · Lukas Woodtli</title>


    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="http://bootswatch.com/yeti/bootstrap.min.css" type="text/css">

    <link rel="stylesheet" href="http://lukaswoodtli.github.io/theme/css/main.css">

    <link rel="stylesheet" href="http://lukaswoodtli.github.io/theme/css/solarized-light.css">


    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

</head>

<body>
  <div class="container" id="wrap">
      <nav id="navbar" class="navbar navbar-default" role="navigation">
    <div class="container">

      <!--navbar-header-->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://lukaswoodtli.github.io">Lukas Woodtli</a>
      </div> <!--navbar-header-->

      <!-- Search Box -->

      <!--Menuitems, collapable-->
      <div class="collapse navbar-collapse" id="navbar-collapse">
        <ul class="nav navbar-nav navbar-right" id="menuitem-list">
                <li >
                  <a href="http://lukaswoodtli.github.io/index.html">Home</a>
                </li>

                <li >
                  <a href="http://lukaswoodtli.github.io/pages/resume.html">Resume</a>
                </li>

              <li class="btn-group">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Skills<b class="caret"></b>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/skills.html">Hard Skills</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/courses.html">Courses</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/books.html">Books</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/projects.html">Projects</a>
                  </li>
                </ul>
              </li>
              <li class="btn-group">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Blog<b class="caret"></b>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/blog.html">Blog Index</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/categories.html">Categories</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/tags.html">Tags</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/archives.html">Chronological</a>
                  </li>
                </ul>
              </li>
                <li >
                  <a href="http://lukaswoodtli.github.io/pages/contact.html">Contact</a>
                </li>

        </ul>
      </div><!-- /.navbar-collapse -->

    </div> <!--container-->
  </nav>


    <div class="container">
      <div class="col-md-2">
      </div>

      <div class="col-md-8">
        <div class="row">
              <div class="page-header">
        <h1><a href="http://lukaswoodtli.github.io/mastering_embedded_linux_programming.html">Mastering Embedded Linux&nbsp;Programming</a></h1>
    </div>

        </div>

        <div class="row">

    <span id="article_info">
    <a class="label label-primary" 
      href="http://lukaswoodtli.github.io/category/programming.html">Programming</a>
      <b> · </b>
        <a class="label label-primary" 
          href="http://lukaswoodtli.github.io/tag/embedded_systems.html">Embedded Systems</a>
        <a class="label label-primary" 
          href="http://lukaswoodtli.github.io/tag/os.html">OS</a>
        <a class="label label-primary" 
          href="http://lukaswoodtli.github.io/tag/linux.html">Linux</a>
        <a class="label label-primary" 
          href="http://lukaswoodtli.github.io/tag/unix.html">Unix</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="http://lukaswoodtli.github.io/archives.html#Year2018">2018</a>-<a href="http://lukaswoodtli.github.io/archives.html#Year2018Month01">01</a>-<a href="http://lukaswoodtli.github.io/archives.html#Year2018Month01">20</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="http://lukaswoodtli.github.io/author/lukas-woodtli.html">Lukas Woodtli</a>
  </span>

  <hr/>

  <div id="article_content">
    <p>Notes to the book <a href="https://www.packtpub.com/networking-and-servers/mastering-embedded-linux-programming">Mastering Embedded Linux Programming</a></p>
<p>My code examples can be found here: <a href="https://github.com/LukasWoodtli/MasteringEmbeddedLinuxProgramming">GitHub</a></p>
<p><em><span class="dquo">“</span>The versions of the main packages […] are U-Boot 2015.07, Linux 4.1, Yocto Project 1.8 “Fido”, and Buildroot 2015.08”</em></p>
<div class="toc">
<ul>
<li><a href="#chapter-1-starting-out">Chapter 1. Starting Out</a><ul>
<li><a href="#selecting-the-right-operating-system">Selecting the right operating system</a></li>
<li><a href="#project-lifecycle">Project lifecycle</a></li>
<li><a href="#the-four-elements-of-embedded-linux">The four elements of embedded Linux</a></li>
<li><a href="#hardware-for-embedded-linux">Hardware for embedded Linux</a></li>
</ul>
</li>
<li><a href="#chapter-2-learning-about-toolchains">Chapter 2. Learning About Toolchains</a><ul>
<li><a href="#what-is-a-toolchain">What is a toolchain?</a></li>
<li><a href="#types-of-toolchain-native-versus-cross-toolchain">Types of toolchain - native versus cross toolchain</a></li>
<li><a href="#cpu-architectures"><span class="caps">CPU</span> architectures</a><ul>
<li><a href="#arm-oabi-eabi-and-eabihf"><span class="caps">ARM</span> <span class="caps">OABI</span>, <span class="caps">EABI</span> and <span class="caps">EABIHF</span></a></li>
<li><a href="#gnu-prefix-tuple"><span class="caps">GNU</span> prefix tuple</a></li>
</ul>
</li>
<li><a href="#choosing-the-c-library">Choosing the C library</a></li>
<li><a href="#finding-a-toolchain">Finding a toolchain</a></li>
<li><a href="#the-sysroot-library-and-header-files">The sysroot, library, and header files</a></li>
<li><a href="#other-tools-in-the-toolchain">Other tools in the toolchain</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="chapter-1-starting-out">Chapter 1. Starting Out</h1>
<p><em><span class="dquo">“</span>At the heart of most embedded devices is a highly integrated chip that contains one or more processor cores and interfaces with main memory, mass storage, and peripherals of many types. This is referred to as a System on Chip, or SoC”</em></p>
<h2 id="selecting-the-right-operating-system">Selecting the right operating system</h2>
<p><em><span class="dquo">“</span>Some things to consider</em></p>
<ul>
<li><em>Is your hardware up to the job? Compared to a traditional <span class="caps">RTOS</span> […], Linux requires a lot more resources. It needs at least a 32-bit processor, and lots more memory.</em></li>
<li><em>Do you have the right skill set? […] detailed knowledge of Linux and how it relates to your hardware.</em></li>
<li><em>Is your system real-time? Linux can handle many real-time activities so long as you pay attention to certain details”</em></li>
</ul>
<h2 id="project-lifecycle">Project lifecycle</h2>
<p><em><span class="dquo">“</span>Four sections that reflect the phases of a project. The phases are not necessarily sequential.”</em></p>
<ul>
<li><em><span class="dquo">“</span>set up the development environment and create a working platform for the later phases. “board bring-up” phase.”</em></li>
<li><em><span class="dquo">“</span>System architecture and design choices […] storage of programs and data, how to divide work between kernel device drivers and applications, and how to initialize the system.”</em></li>
<li><em><span class="dquo">“</span>Writing embedded applications […] Linux process and threads model and how to manage memory in a resource-constrained device.”</em></li>
<li><em><span class="dquo">“</span>Debugging and optimizing performance […] trace, profile, and debug your code in both the applications and the kernel.”</em></li>
</ul>
<p><em><span class="dquo">“</span>Debugging and optimizing performance (chapters 12 and 13) describe how to trace, profile, and debug your code in both the applications and the kernel.”</em></p>
<h2 id="the-four-elements-of-embedded-linux">The four elements of embedded Linux</h2>
<ul>
<li><em><span class="dquo">“</span>Toolchain: This consists of the compiler and other tools needed to create code for your target device. Everything else depends on the toolchain.”</em></li>
<li><em><span class="dquo">“</span>Bootloader: This is necessary to initialize the board and to load and boot the Linux kernel.”</em></li>
<li><em><span class="dquo">“</span>Kernel: This is the heart of the system, managing system resources and interfacing with hardware.”</em></li>
<li><em><span class="dquo">“</span>Root filesystem: This contains the libraries and programs”</em></li>
</ul>
<h2 id="hardware-for-embedded-linux">Hardware for embedded Linux</h2>
<p><em><span class="dquo">“</span>[In] source code for Linux 4.1, there are 30 architectures, each represented by a sub-directory in the <code>arch/</code> directory. They are all 32- or 64-bit architectures, most with a <strong>memory management unit (<span class="caps">MMU</span>)</strong>, but some without.”</em></p>
<p><em><span class="dquo">“</span>There is another group that doesn’t have an <span class="caps">MMU</span> that runs a subset of Linux known as micro controller Linux or uClinux.”</em></p>
<p><em><span class="dquo">“</span>[Linux needs] a reasonable amount of <span class="caps">RAM</span>. 16 MiB is a good minimum”</em></p>
<p><em><span class="dquo">“</span>[We need] non-volatile storage, usually flash memory. 8 MiB is enough for a simple device”</em></p>
<p><em><span class="dquo">“</span>Linux has extensive support for flash storage devices, including raw <span class="caps">NOR</span> and <span class="caps">NAND</span> flash chips and managed flash in the form of <span class="caps">SD</span> cards, eMMC chips, <span class="caps">USB</span> flash memory”</em></p>
<p><em><span class="dquo">“</span>A debug port is very useful, most commonly an <span class="caps">RS</span>-232 serial port. It does not have to be fitted on production boards, but makes board bring-up, debugging, and development much easier.”</em></p>
<p><em><span class="dquo">“</span>[We] need some means of loading software when starting from scratch. [For example <span class="caps">JTAG</span>] but modern SoCs have the ability to load boot code directly from removable media, especially <span class="caps">SD</span> and micro <span class="caps">SD</span> cards, or serial interfaces such as <span class="caps">RS</span>-232 or <span class="caps">USB</span>.”</em></p>
<h1 id="chapter-2-learning-about-toolchains">Chapter 2. Learning About Toolchains</h1>
<h2 id="what-is-a-toolchain">What is a toolchain?</h2>
<p><em><span class="dquo">“</span>A standard <span class="caps">GNU</span> toolchain consists of three main components:”</em></p>
<ul>
<li><a href="http://www.gnu.org/software/binutils/">Binutils</a>: Assembler, linker, (ld) and other tools</li>
<li><a href="http://gcc.gnu.org/"><span class="caps">GCC</span></a>: Compilers for C, C++, Objective-C, Objective-C++, Java, Fortran, Ada, and Go. They all use a common back-end which produces assembler code for the <span class="caps">GNU</span> assembler (<span class="caps">GAS</span>)</li>
<li><strong>C library</strong>: Standardized <span class="caps">API</span> based on <span class="caps">POSIX</span> (interface to the operating system kernel from applications)</li>
</ul>
<p><em><span class="dquo">“</span>As well as these, you will need a copy of the Linux kernel headers,”</em></p>
<p><em><span class="dquo">“</span>of the header files in the include directory of your kernel source code. Those headers are intended for use in the kernel only and contain definitions that will cause conflicts if used in their raw state to compile regular Linux applications. Instead, you will need to generate a set of sanitized kernel headers”</em></p>
<h2 id="types-of-toolchain-native-versus-cross-toolchain">Types of toolchain - native versus cross toolchain</h2>
<p><em><span class="dquo">“</span>here are two types of toolchain:</em></p>
<ul>
<li><em>Native: This toolchain runs on the same type of system […] This is the usual case for desktops and servers, and it is becoming popular on certain classes of embedded devices. […]</em></li>
<li><em>Cross: This toolchain runs on a different type of system than the target, allowing the development to be done on a fast desktop <span class="caps">PC</span> and then loaded onto the embedded target for testing.”</em></li>
</ul>
<p><em><span class="dquo">“</span>Almost all embedded Linux development is done using a cross development toolchain, partly because most embedded devices are not well suited to program development since they lack computing power, memory, and storage, but also because it keeps the host and target environments separate.”</em></p>
<p><em><span class="dquo">“</span>there is a counter argument in favor of native development. Cross development creates the burden of cross-compiling all the libraries and tools that you need for your target.”</em></p>
<h2 id="cpu-architectures"><span class="caps">CPU</span> architectures</h2>
<p><em><span class="dquo">“</span>toolchain has to be built according to the capabilities of the target <span class="caps">CPU</span>:</em></p>
<ul>
<li><em><span class="caps">CPU</span> architecture: arm, mips, x86_64, and so on</em></li>
<li><em>Big- or little-endian operation: Some CPUs can operate in both modes, but the machine code is different for each</em></li>
<li><em>Floating point support: Not all versions of embedded processors implement a hardware floating point unit, in which case, the toolchain can be configured to call a software floating point library instead</em></li>
<li><em>Application Binary Interface (<span class="caps">ABI</span>): The calling convention used for passing parameters between function calls”</em></li>
</ul>
<h3 id="arm-oabi-eabi-and-eabihf"><span class="caps">ARM</span> <span class="caps">OABI</span>, <span class="caps">EABI</span> and <span class="caps">EABIHF</span></h3>
<p><em><span class="dquo">“</span>With many architectures, the <span class="caps">ABI</span> is constant across the family of processors. One notable exception is <span class="caps">ARM</span>. The <span class="caps">ARM</span> architecture transitioned to the </em>Extended Application Binary Interface<em> (<strong><span class="caps">EABI</span></strong>) in the late 2000’s, resulting in the previous <span class="caps">ABI</span> being named the </em>Old Application Binary Interface<em> (<strong><span class="caps">OABI</span></strong>). While the <span class="caps">OABI</span> is now obsolete, you continue to see references to <span class="caps">EABI</span>. Since then, the </em><span class="caps">EABI</span> has split into two<em>, based on the way that floating point parameters are passed. The </em>original <span class="caps">EABI</span> uses general purpose (integer)<em> registers</em> while the <em>newer <strong><span class="caps">EABIHF</span></strong> uses floating point registers. The <span class="caps">EABIHF</span> is significantly faster at floating point operations since it removes the need for copying between integer and floating point registers, but it is not compatible with CPUs that do not have a floating point unit. The choice, then, is between two incompatible ABIs: </em>you cannot mix and match the two<em> and so you have to decide at this stage.”</em></p>
<h3 id="gnu-prefix-tuple"><span class="caps">GNU</span> prefix tuple</h3>
<p><em><span class="dquo">“</span><span class="caps">GNU</span> uses a prefix to the tools to identify the various combinations that can be generated, consisting of a tuple of three or four components separated by dashes:</em></p>
<ul>
<li><em><span class="caps">CPU</span>: The <span class="caps">CPU</span> architecture, such as arm, mips, or x86_64. If the <span class="caps">CPU</span> has both endian modes, they may be differentiated by adding <strong>el for little-endian</strong>, or <strong>eb for big-endian</strong>. Good examples are little-endian <span class="caps">MIPS</span>, mipsel and big-endian <span class="caps">ARM</span>, armeb.</em></li>
<li><em>Vendor: This identifies the provider of the toolchain. Examples include buildroot, poky, or just unknown. Sometimes it is left out altogether.</em></li>
<li><em>Kernel: For our purposes, it is always ‘linux’.</em></li>
<li><em>Operating system: A name for the user space component, which might be <code>gnu</code> or <code>uclibcgnu</code>. The <span class="caps">ABI</span> may be appended here as well so, for <span class="caps">ARM</span> toolchains, you may see <code>gnueabi</code>, <code>gnueabihf</code>, <code>uclibcgnueabi</code>, or <code>uclibcgnueabihf</code>.”</em></li>
</ul>
<p><em><span class="dquo">“</span>You can find the tuple used when building the toolchain by using the <code>-dumpmachine</code> option of <code>gcc</code><span class="dquo">“</span></em></p>
<h2 id="choosing-the-c-library">Choosing the C library</h2>
<p><em><span class="dquo">“</span>The programming interface to the Unix operating system is defined in the C language, which is now defined by the <strong><span class="caps">POSIX</span></strong> standards. The C library is the implementation of that interface”</em></p>
<p><em><span class="dquo">“</span>There are several C libraries:</em></p>
<ul>
<li><em>glibc: is the standard <span class="caps">GNU</span> C library. It is big and, until recently, not very configurable, but it is the most complete implementation</em></li>
<li><em>eglibc: This is the embedded <span class="caps">GLIBC</span>. […] the code base from eglibc has been merged back into glibc. eglibc is no longer maintained.</em></li>
<li><em>uClibc: was first developed to work with uClinux. There is a configuration utility which allows you to fine-tune its features to your needs. […] smaller than glibc</em></li>
<li><em>musl libc: is a new C library designed for embedded systems.</em>”</li>
</ul>
<p><em><span class="dquo">“</span>So, which to choose?</em></p>
<ul>
<li><em>uClibc only if you are using uClinux or if you have very limited amounts of storage or <span class="caps">RAM</span></em></li>
<li><em>Otherwise, I prefer to use an up-to-date glibc, or eglibc”</em></li>
</ul>
<h2 id="finding-a-toolchain">Finding a toolchain</h2>
<p><em><span class="dquo">“</span>three choices for your cross development toolchain:</em></p>
<ul>
<li><em>a ready built toolchain that matches your needs</em> (i.e. <a href="https://www.linaro.org/">Linaro</a> for <span class="caps">ARM</span>)</li>
<li><em>generated by an embedded build tool</em> (i.e. Yocto)</li>
<li><em>create one yourself”</em> (crosstool-ng)</li>
</ul>
<h2 id="the-sysroot-library-and-header-files">The sysroot, library, and header files</h2>
<p><em><span class="dquo">“</span>The toolchain sysroot is a directory which contains subdirectories for libraries, header files, and other configuration files.”</em></p>
<p><em><span class="dquo">“</span>You will find the following in the sysroot:</em>
- <em><code>lib</code>: Contains the shared objects for the C library and the dynamic linker/loader, <code>ld-linux</code></em>
- <em><code>usr/lib</code>: the static library archives for the C library and any other libraries that may be installed subsequently</em>
- <em><code>usr/include</code>: Contains the headers for all the libraries</em>
- <em><code>usr/bin</code>: Contains the utility programs that run on the target, such as the <code>ldd</code> command</em>
- <em><code>/usr/share</code>: Used for localization and internationalization</em>
- <em><code>sbin</code>: Provides the ldconfig utility, used to optimize library loading paths</em>”</p>
<p><em><span class="dquo">“</span>some of these are needed on the development host to compile programs, and others - for example the shared libraries and <code>ld-linux</code> - are needed on the target at runtime.”</em></p>
<h2 id="other-tools-in-the-toolchain">Other tools in the toolchain</h2>
<ul>
<li><code>addr2line</code>: Converts program addresses into filenames and numbers. Useful for decoding addresses from a crash report</li>
<li><code>ar</code>: used to create static libraries</li>
<li><code>as</code>: <span class="caps">GNU</span> assembler</li>
<li><code>c++filt</code>: demangle C++ and Java symbols</li>
<li><code>cpp</code>: Standalone C preprocessor</li>
<li><code>elfedit</code>: update the <span class="caps">ELF</span> header</li>
<li><code>gcov</code>: coverage tool</li>
<li><code>gdb</code>: <span class="caps">GNU</span> debugger</li>
<li><code>gprof</code>: profiling tool</li>
<li><code>ld</code>: the <span class="caps">GNU</span> linker</li>
<li><code>nm</code>: list symbols from object files</li>
<li><code>objcopy</code>: copy and translate object files</li>
<li><code>objdump</code>: display information from object files</li>
<li><code>ranlib</code>: creates or modifies an index in a static library, making the linking stage faster</li>
<li><code>readelf</code>: display information in <span class="caps">ELF</span> object files</li>
<li><code>size</code>: list section sizes</li>
<li><code>strings</code>: display printable characters in files</li>
<li><code>strip</code>: strip the debug symbols of object file</li>
</ul>
  </div>

  <hr/>

      <ul class="pager">
        <li class="previous">
          <a href="http://lukaswoodtli.github.io/gcc_binutils_and_other_developer_tools.html">
          &laquo; Newer</a>
        </li>
        <li class="next">
          <a href="http://lukaswoodtli.github.io/language_implementation_patterns.html">
          Older &raquo;</a>
        </li>
      </ul>


        </div>

        <div class="row">
        </div>

      </div>

      <div class="col-md-2">
      </div>
    </div>


  </div>

    <nav id="footer" class="navbar navbar-default">
    <div class="container">
        <p id="footer-text" class="navbar-text text-center">
          <span id="engine">
            Compiled using
            <a href="http://docs.getpelican.com">Pelican</a>
          </span>
          <span id="theme">
            with theme
            <a href="http://github.com/yuex/pelican-chameleon">Chameleon</a>
          </span>
          <span id="bootstrap">
            on top of
            <a href="http://getbootstrap.com/">Bootstrap</a>
          </span>
        </p>
      </div>
    </div>
  </nav>


</body>
</html>