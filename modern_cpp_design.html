<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="Lukas Woodtli">
    <meta name="author" content="Lukas Woodtli">

        <title>Modern C++&nbsp;Design · Lukas Woodtli</title>


    <!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="http://bootswatch.com/yeti/bootstrap.min.css" type="text/css">

    <link rel="stylesheet" href="http://lukaswoodtli.github.io/theme/css/main.css">

    <link rel="stylesheet" href="http://lukaswoodtli.github.io/theme/css/solarized-light.css">


    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

</head>

<body>
  <div class="container" id="wrap">
      <nav id="navbar" class="navbar navbar-default" role="navigation">
    <div class="container">

      <!--navbar-header-->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://lukaswoodtli.github.io">Lukas Woodtli</a>
      </div> <!--navbar-header-->

      <!-- Search Box -->

      <!--Menuitems, collapable-->
      <div class="collapse navbar-collapse" id="navbar-collapse">
        <ul class="nav navbar-nav navbar-right" id="menuitem-list">
                <li >
                  <a href="http://lukaswoodtli.github.io/index.html">Home</a>
                </li>

                <li >
                  <a href="http://lukaswoodtli.github.io/pages/resume.html">Resume</a>
                </li>

              <li class="btn-group">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Skills<b class="caret"></b>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/skills.html">Hard Skills</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/courses.html">Courses</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/books.html">Books</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/projects.html">Projects</a>
                  </li>
                </ul>
              </li>
              <li class="btn-group">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Blog<b class="caret"></b>
                </a>
                <ul class="dropdown-menu" role="menu">
                  <li >
                    <a href="http://lukaswoodtli.github.io/pages/blog.html">Blog Index</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/categories.html">Categories</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/tags.html">Tags</a>
                  </li>
                  <li >
                    <a href="http://lukaswoodtli.github.io/archives.html">Chronological</a>
                  </li>
                </ul>
              </li>
                <li >
                  <a href="http://lukaswoodtli.github.io/pages/contact.html">Contact</a>
                </li>

        </ul>
      </div><!-- /.navbar-collapse -->

    </div> <!--container-->
  </nav>


    <div class="container">
      <div class="col-md-2">
      </div>

      <div class="col-md-8">
        <div class="row">
              <div class="page-header">
        <h1><a href="http://lukaswoodtli.github.io/modern_cpp_design.html">Modern C++&nbsp;Design</a></h1>
    </div>

        </div>

        <div class="row">

    <span id="article_info">
    <a class="label label-primary" 
      href="http://lukaswoodtli.github.io/category/programming.html">Programming</a>
      <b> · </b>
        <a class="label label-primary" 
          href="http://lukaswoodtli.github.io/tag/cpp.html">C++</a>
    <!--<span class="glyphicon glyphicon-calendar"></span>-->
      <b> · </b>
      <a href="http://lukaswoodtli.github.io/archives.html#Year2017">2017</a>-<a href="http://lukaswoodtli.github.io/archives.html#Year2017Month02">02</a>-<a href="http://lukaswoodtli.github.io/archives.html#Year2017Month02">03</a>

    <!--<span class="glyphicon glyphicon-user"></span>-->
      <b> · </b>
    <a href="http://lukaswoodtli.github.io/author/lukas-woodtli.html">Lukas Woodtli</a>
  </span>

  <hr/>

  <div id="article_content">
    <h1 id="part-i-techniques">Part I. Techniques</h1>
<h2 id="policy-based-class-design">Policy-Based Class Design</h2>
<h3 id="the-benefit-of-templates">The Benefit of Templates</h3>
<p><em><span class="dquo">“</span>Templates are a good candidate for coping with combinatorial behaviors because they generate code at compile time based on the types (and/or constant values) provided by the user.
Class templates are customizable in ways not supported by regular classes.”</em></p>
<p><em><span class="dquo">“</span>Furthermore, for class templates you can use partial template specialization […]. Partial template specialization gives you the ability to specialize a class template for only some of its arguments.”</em></p>
<p><em><span class="dquo">“</span>[…] several problems that are not self-evident:</em></p>
<ol>
<li><em>You cannot specialize structure. Using templates alone, you cannot specialize the structure of a class (its data members). You can only specialize functions.</em></li>
<li><em>Partial specialization of member functions does not scale. You can specialize any member function of a class template with one template parameter, but you cannot specialize individual member functions for templates with multiple template parameters.</em></li>
<li><em><span class="dquo">“</span>The library writer cannot provide multiple default values. At best, a class template implementer can provide a single default implementation for each member function. You cannot provide several defaults for a template member function.”</em></li>
</ol>
<p>Member functions can be only fully specialized:</p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> 
<span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span> 
    <span class="kt">void</span> <span class="n">Fun</span><span class="p">()</span> <span class="p">{</span> <span class="p">..</span> <span class="n">generic</span> <span class="n">implementation</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// ok: specialization allowed</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="kt">void</span> <span class="n">Widget</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;::</span><span class="n">Fun</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="n">specialized</span> <span class="n">implementation</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
<p>Partial specialization is not allowed:</p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">U</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Gadget</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">Fun</span><span class="p">()</span> <span class="p">{</span> <span class="p">..</span> <span class="n">generic</span> <span class="n">implementation</span> <span class="p">...</span> <span class="p">}</span> 
<span class="p">};</span>

<span class="c1">// error: member functions can't be specialized partially</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">U</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">Gadget</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;::</span><span class="n">Fun</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="n">specialized</span> <span class="n">implementation</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
<p>Policies and Policy Classes ~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p><em><span class="dquo">“</span>A <strong>policy</strong> defines a class interface or a class template interface. The interface consists of one or all of the following: inner type definitions, member functions, and member variables.”</em></p>
<p><em><span class="dquo">“</span>Policies have much in common with <strong>traits</strong> but differ in that they put less emphasis on type and more emphasis on behavior. Also, policies are reminiscent of the <strong>Strategy design pattern</strong>, with the twist that policies are bound at compilation time.”</em></p>
<p><em><span class="dquo">“</span>For a given policy, there can be an unlimited number of implementations. The implementations of a policy are called <strong>policy classes</strong>”</em></p>
<p><em><span class="dquo">“</span>Policy classes are not intended for stand-alone use […]”</em></p>
<p><em><span class="dquo">“</span>Policies are syntax oriented, not signature oriented.”</em></p>
<p><em><span class="dquo">“</span>[A] policy does not specify that [a member function] must be static or virtual—the only requirement is that the class template define a [coresponding (with the expected signature)] member function.”</em></p>
<p><em><span class="dquo">“</span>The classes that use one or more policies are called <strong>hosts</strong> or <strong>host classes</strong>”</em></p>
<p>Implementing Policy Classes with Template Template Parameters ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p><em><span class="dquo">“</span>Library code can use template template parameters for specifying policies”</em></p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">Created</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">CreationPolicy</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">WidgetManager</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CreationPolicy</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="p">{</span> 
    <span class="c1">// ...</span>
<span class="p">};</span>
</pre></div>
<p><em><span class="dquo">“</span>The <code>Created</code> symbol does not contribute to the definition of <code>WidgetManager</code>. You cannot use <code>Created</code> inside <code>WidgetManager</code> - it is a formal argument for <code>CreationPolicy</code> (not <code>WidgetManager</code>) and can be simply omitted.”</em></p>
<p><em><span class="dquo">“</span>First, you can change policies <strong>from the outside</strong> as easily as changing a template argument […]. Second, you can provide your own policies that are specific to your concrete application.”</em></p>
<p><em><span class="dquo">“</span>[The author might] provide a default template argument for the policy that’s most commonly used:”</em></p>
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">template</span> <span class="o">&lt;</span><span class="n">class</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">CreationPolicy</span> <span class="o">=</span> <span class="n">OpNewCreator</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">WidgetManager</span> <span class="p">...</span>
</pre></div>
<p><em><span class="dquo">“</span>Policies are quite different from mere virtual functions. […] policies come with […] static binding.”</em></p>
<p><em><span class="dquo">“</span>policies’ features also make them <strong>unsuitable</strong> for <strong>dynamic binding</strong> and <strong>binary interfaces</strong>, so in essence policies and classic interfaces do not compete.”</em></p>
<p>Destructors of Policy Classes ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p>
<p><em><span class="dquo">“</span>Defining a virtual destructor for a policy […] works against its static nature and hurts performance.”</em></p>
<p><em><span class="dquo">“</span>The lightweight, effective solution that policies should use is to define a <strong>nonvirtual protected destructor</strong>”</em></p>
  </div>

  <hr/>

      <ul class="pager">
        <li class="previous">
          <a href="http://lukaswoodtli.github.io/unix_device_files.html">
          &laquo; Newer</a>
        </li>
        <li class="next">
          <a href="http://lukaswoodtli.github.io/structure_and_interpretation_of_computer_programs.html">
          Older &raquo;</a>
        </li>
      </ul>


        </div>

        <div class="row">
        </div>

      </div>

      <div class="col-md-2">
      </div>
    </div>


  </div>

    <nav id="footer" class="navbar navbar-default">
    <div class="container">
        <p id="footer-text" class="navbar-text text-center">
          <span id="engine">
            Compiled using
            <a href="http://docs.getpelican.com">Pelican</a>
          </span>
          <span id="theme">
            with theme
            <a href="http://github.com/yuex/pelican-chameleon">Chameleon</a>
          </span>
          <span id="bootstrap">
            on top of
            <a href="http://getbootstrap.com/">Bootstrap</a>
          </span>
        </p>
      </div>
    </div>
  </nav>


</body>
</html>